<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Admin - Edit event title and numbers</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 24px;
        }
        .admin-wrap { max-width: 480px; margin: 0 auto; }
        h1 { font-size: 22px; margin-bottom: 20px; color: #00C896; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 14px; color: #aaa; }
        .form-group input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #2a2a3e; color: #fff; font-size: 16px; }
        .form-group input:focus { outline: 2px solid #00C896; outline-offset: 2px; }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #00C896; color: #000; margin-top: 8px; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .msg { margin-top: 16px; padding: 12px; border-radius: 8px; font-size: 14px; display: none; }
        .msg.success { display: block; background: rgba(0,200,150,0.2); color: #00C896; }
        .msg.error { display: block; background: rgba(255,68,68,0.2); color: #ff4444; }
        .login-box { max-width: 320px; margin: 40px auto; padding: 24px; background: #2a2a3e; border-radius: 12px; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #333; background: #1a1a2e; color: #fff; }
        .login-box button { width: 100%; padding: 12px; background: #00C896; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .login-box .error { color: #ff4444; font-size: 14px; margin-top: 8px; display: none; }
        .login-box .error.show { display: block; }
        .hint { font-size: 12px; color: #888; margin-top: 20px; }
        .hint a { color: #00C896; }
    </style>
</head>
<body>
    <div id="login-box" class="login-box">
        <h2 style="margin-bottom:16px;">Admin login</h2>
        <input type="password" id="login-password" placeholder="Password" autocomplete="off">
        <button type="button" id="login-btn">Enter</button>
        <p id="login-error" class="error">Wrong password.</p>
    </div>

    <div id="admin-panel" class="admin-wrap" style="display:none;">
        <h1>Edit event (title & numbers)</h1>
        <form id="config-form">
            <div class="form-group">
                <label>Event title (text at top)</label>
                <input type="text" id="eventTitle" placeholder="e.g. Register For Latin Party" required>
            </div>
            <div class="form-group">
                <label>Going – main number (e.g. 187 People Going)</label>
                <input type="number" id="goingNum" min="0" required>
            </div>
            <div class="form-group">
                <label>Going – number below images (e.g. 184+)</label>
                <input type="number" id="goingPlus" min="0" required>
            </div>
            <div class="form-group">
                <label>Interesting – main number (e.g. 34 People Interesting)</label>
                <input type="number" id="interestingNum" min="0" required>
            </div>
            <div class="form-group">
                <label>Interesting – number below images (e.g. 31+)</label>
                <input type="number" id="interestingPlus" min="0" required>
            </div>
            <button type="submit" class="btn btn-primary" id="save-btn">Save changes</button>
        </form>
        <p id="msg" class="msg"></p>
        <p class="hint">To change the 6 profile images, upload new files to the <strong>profiles</strong> folder on GitHub (same names: going1.jpg, going2.jpg, etc.). See HOW_TO_UPLOAD_IMAGES_ON_GITHUB.md</p>
    </div>

    <script>
        (function() {
            // ========== SET THESE TO MATCH YOUR APPS SCRIPT ==========
            var CONFIG_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwaVksAPzPccOyjzXkISkl-87iBpnEdfQXPu6QVASQgoS_Fgo_Nk81g3bdsRtfK446F-w/exec';
            var ADMIN_PASSWORD = '7602';  // Same as adminSecret in Apps Script

            var loginBox = document.getElementById('login-box');
            var adminPanel = document.getElementById('admin-panel');
            var loginPassword = document.getElementById('login-password');
            var loginBtn = document.getElementById('login-btn');
            var loginError = document.getElementById('login-error');
            var configForm = document.getElementById('config-form');
            var saveBtn = document.getElementById('save-btn');
            var msgEl = document.getElementById('msg');

            function showMsg(text, isError) {
                msgEl.textContent = text;
                msgEl.className = 'msg ' + (isError ? 'error' : 'success');
                msgEl.style.display = 'block';
            }

            function hideMsg() {
                msgEl.style.display = 'none';
            }

            loginBtn.addEventListener('click', function() {
                if (loginPassword.value === ADMIN_PASSWORD) {
                    loginBox.style.display = 'none';
                    adminPanel.style.display = 'block';
                    loginError.classList.remove('show');
                    loadConfig();
                } else {
                    loginError.classList.add('show');
                }
            });

            loginPassword.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') loginBtn.click();
            });

            function loadConfig() {
                saveBtn.disabled = true;
                fetch(CONFIG_SCRIPT_URL)
                    .then(function(r) { return r.json(); })
                    .then(function(data) {
                        document.getElementById('eventTitle').value = data.eventTitle || '';
                        document.getElementById('goingNum').value = data.goingNum != null ? data.goingNum : 187;
                        document.getElementById('goingPlus').value = data.goingPlus != null ? data.goingPlus : 184;
                        document.getElementById('interestingNum').value = data.interestingNum != null ? data.interestingNum : 34;
                        document.getElementById('interestingPlus').value = data.interestingPlus != null ? data.interestingPlus : 31;
                    })
                    .catch(function() {
                        showMsg('Could not load config. Check CONFIG_SCRIPT_URL and that your Config Apps Script is deployed.', true);
                    })
                    .finally(function() { saveBtn.disabled = false; });
            }

            configForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveBtn.disabled = true;
                hideMsg();
                var payload = {
                    secret: ADMIN_PASSWORD,
                    eventTitle: document.getElementById('eventTitle').value.trim(),
                    goingNum: parseInt(document.getElementById('goingNum').value, 10) || 0,
                    goingPlus: parseInt(document.getElementById('goingPlus').value, 10) || 0,
                    interestingNum: parseInt(document.getElementById('interestingNum').value, 10) || 0,
                    interestingPlus: parseInt(document.getElementById('interestingPlus').value, 10) || 0
                };
                var iframe = document.getElementById('save-frame');
                if (!iframe) {
                    iframe = document.createElement('iframe');
                    iframe.name = 'save-frame';
                    iframe.id = 'save-frame';
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);
                }
                var form = document.createElement('form');
                form.action = CONFIG_SCRIPT_URL;
                form.method = 'POST';
                form.target = '_blank';  // يفتح تبويباً جديداً لرؤية رد السكربت (OK / Forbidden / Invalid JSON). بعد التأكد غيّره إلى 'save-frame'
                form.style.display = 'none';
                var input = document.createElement('input');
                input.name = 'data';
                input.value = JSON.stringify(payload);
                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);
                showMsg('Saved. Your event page will show the new title and numbers.');
                saveBtn.disabled = false;
            });
        })();
    </script>
</body>
</html>

